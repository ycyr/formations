
# ğŸ§ª TP â€“ Jobs & CronJobs dans Kubernetes

## ğŸ¯ Objectifs pÃ©dagogiques

- Comprendre les objets `Job` et `CronJob`
- CrÃ©er des tÃ¢ches Ã  exÃ©cution unique et planifiÃ©e
- Observer la hiÃ©rarchie CronJob â†’ Job â†’ Pod
- Tester les logs, Ã©checs, relances

---

  ## ğŸŸ¦ Ã‰tape 1 â€“ CrÃ©er un namespace dÃ©diÃ©

```bash
kubectl create namespace tp-batch
```

## ğŸŸ¦ Ã‰tape 2 â€“ CrÃ©er un Job qui rÃ©ussit

âœ… job-ok.yaml
```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: job-ok
  namespace: tp-batch
spec:
  template:
    spec:
      containers:
      - name: job
        image: busybox
        command: ["echo", "Hello from Job"]
      restartPolicy: Never
```

```bash
kubectl apply -f job-ok.yaml
```
```
kubectl get jobs -n tp-batch
```
```
kubectl get pods -n tp-batch
```
```
kubectl logs -n tp-batch -l job-name=job-ok
```

## ğŸŸ¦ Ã‰tape 3 â€“ CrÃ©er un Job qui Ã©choue

âœ… job-ko.yaml

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: job-ko
  namespace: tp-batch
spec:
  backoffLimit: 3   # RÃ©essaie 3 fois
  template:
    spec:
      containers:
      - name: job
        image: busybox
        command: ["false"]
      restartPolicy: Never
```

```bash
kubectl apply -f job-ko.yaml
```
```
kubectl get jobs -n tp-batch
```
```
kubectl get pods -n tp-batch
```

ğŸ’¡ Le Job va Ã©chouer 3 fois puis sâ€™arrÃªter.

## ğŸŸ¦ Ã‰tape 4 â€“ CrÃ©er un CronJob planifiÃ© (toutes les minutes)

âœ… cronjob.yaml


```yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: cronjob-hello
  namespace: tp-batch
spec:
  schedule: "*/1 * * * *"  # Toutes les minutes
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: cron
            image: busybox
            command: ["echo", "Hello from CronJob"]
          restartPolicy: OnFailure
```


```bash
kubectl apply -f cronjob.yaml
```

## ğŸŸ¦ Ã‰tape 5 â€“ Observer les Jobs et Pods gÃ©nÃ©rÃ©s par le CronJob


```bash
kubectl get cronjobs -n tp-batch
```
```
kubectl get jobs -n tp-batch
```
```
kubectl get pods -n tp-batch
```

# ATTENDRE 60 secondes:

ğŸ’¬ Chaque minute, un nouveau Job sera gÃ©nÃ©rÃ© automatiquement, avec un nom comme :

```bash
kubectl get pods -n tp-batch
```

```bash
cronjob-hello-2795017
```

âœ… Lire les logs du Pod crÃ©Ã© :

```bash
kubectl logs -n tp-batch -l job-name=cronjob-hello-xxxxxxx
```

(ou liste les Pods, puis kubectl logs <pod-name>)

 ## ğŸŸ¦ Ã‰tape 6 â€“ Nettoyer les ressources

```bash
kubectl delete namespace tp-batch
```

âœ… RÃ©sumÃ©

| Ã‰lÃ©ment              | Fonction                                   |
|----------------------|--------------------------------------------|
| StatefulSet          | GÃ¨re les Pods avec nom et stockage stables |
| volumeClaimTemplates | GÃ©nÃ¨re un PVC par Pod                      |
| Headless Service     | Permet DNS par Pod (web-0, web-1, ...)     |
| Persistance          | Les donnÃ©es du Pod sont conservÃ©es         |

ğŸ’¡ Utiliser restartPolicy: Never pour Ã©viter les boucles de Pods.




