
# 🧪 TP – Jobs & CronJobs dans Kubernetes

## 🎯 Objectifs pédagogiques

- Comprendre les objets `Job` et `CronJob`
- Créer des tâches à exécution unique et planifiée
- Observer la hiérarchie CronJob → Job → Pod
- Tester les logs, échecs, relances

---

## 🟦 Étape 1 – Créer un namespace dédié

```bash
kubectl create namespace tp-batch

🟦 Étape 2 – Créer un Job qui réussit

✅ job-ok.yaml

apiVersion: batch/v1
kind: Job
metadata:
  name: job-ok
  namespace: tp-batch
spec:
  template:
    spec:
      containers:
      - name: job
        image: busybox
        command: ["echo", "Hello from Job"]
      restartPolicy: Never

kubectl apply -f job-ok.yaml
kubectl get jobs -n tp-batch
kubectl get pods -n tp-batch
kubectl logs -n tp-batch -l job-name=job-ok

🟦 Étape 3 – Créer un Job qui échoue

✅ job-ko.yaml

apiVersion: batch/v1
kind: Job
metadata:
  name: job-ko
  namespace: tp-batch
spec:
  backoffLimit: 3   # Réessaie 3 fois
  template:
    spec:
      containers:
      - name: job
        image: busybox
        command: ["false"]
      restartPolicy: Never

kubectl apply -f job-ko.yaml
kubectl get jobs -n tp-batch
kubectl get pods -n tp-batch

💡 Le Job va échouer 3 fois puis s’arrêter.

🟦 Étape 4 – Créer un CronJob planifié (toutes les minutes)

✅ cronjob.yaml

apiVersion: batch/v1
kind: CronJob
metadata:
  name: cronjob-hello
  namespace: tp-batch
spec:
  schedule: "*/1 * * * *"  # Toutes les minutes
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: cron
            image: busybox
            command: ["echo", "Hello from CronJob"]
          restartPolicy: OnFailure

kubectl apply -f cronjob.yaml

🟦 Étape 5 – Observer les Jobs et Pods générés par le CronJob

kubectl get cronjobs -n tp-batch
kubectl get jobs -n tp-batch
kubectl get pods -n tp-batch

💬 Chaque minute, un nouveau Job sera généré automatiquement, avec un nom comme :

cronjob-hello-27950178

✅ Lire les logs du Pod créé :

kubectl logs -n tp-batch -l job-name=cronjob-hello-xxxxxxx

(ou liste les Pods, puis kubectl logs <pod-name>)

🟦 Étape 6 – Nettoyer les ressources

kubectl delete namespace tp-batch

✅ Résumé

Ressource

Fonction

Contrôle

Job

Exécution unique

Jusqu’à succès ou échec

CronJob

Exécutions planifiées

Crée un Job à chaque exécution

Pod

Exécuté par un Job

Automatiquement

💡 Utiliser restartPolicy: Never pour éviter les boucles de Pods.




