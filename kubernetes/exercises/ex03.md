# ğŸ§ª TP 3 â€“ Deployment : gestion de la scalabilitÃ© et des mises Ã  jour

## ğŸ¯ Objectifs

- CrÃ©er un Deployment dans un namespace spÃ©cifique
- Comprendre la relation Deployment â†” ReplicaSet â†” Pods
- GÃ©rer la scalabilitÃ© (nombre de rÃ©plicas)
- RÃ©aliser une mise Ã  jour dâ€™image de maniÃ¨re contrÃ´lÃ©e

---

## ğŸŸ¦ Ã‰tape 1 â€“ CrÃ©er le namespace `tp-deployment`

```bash
kubectl create namespace tp-deployment
```

---

## ğŸŸ¦ Ã‰tape 2 â€“ CrÃ©er un Deployment avec 3 Pods

### âœ… `deployment.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-deployment
  namespace: tp-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
```

```bash
kubectl apply -f deployment.yaml
```

---

## ğŸŸ¦ Ã‰tape 3 â€“ Observer les ressources crÃ©Ã©es

```bash
kubectl get deployments -n tp-deployment
```
```
kubectl get replicasets -n tp-deployment
```
```
kubectl get pods -n tp-deployment
```

### ğŸ” Nommage :
- **Deployment** : `web-deployment`
- **ReplicaSet** : `web-deployment-xxxxx`
- **Pods** : `web-deployment-xxxxx-yyyyy`

> ğŸ“Œ Le nom du ReplicaSet est dÃ©rivÃ© du Deployment  
> ğŸ“Œ Les Pods sont dÃ©rivÃ©s du ReplicaSet

---

## ğŸŸ¦ Ã‰tape 4 â€“ Supprimer un Pod et observer la recrÃ©ation automatique

```bash
kubectl delete pod <nom-du-pod> -n tp-deployment
```
```
kubectl get pods -n tp-deployment 
```

ğŸ’¡ Le Deployment, via le ReplicaSet, **recrÃ©e automatiquement** un nouveau Pod.

---

## ğŸŸ¦ Ã‰tape 5 â€“ Modifier le nombre de Pods (scaling)

### ğŸ”¼ Augmenter Ã  5 :
```bash
kubectl scale deployment web-deployment --replicas=5 -n tp-deployment
```
```
kubectl get pods -n tp-deployment
```

### ğŸ”½ RÃ©duire Ã  2 :
```bash
kubectl scale deployment web-deployment --replicas=2 -n tp-deployment
```
```
kubectl get pods -n tp-deployment
```

### ğŸ” VÃ©rifier lâ€™impact :
```bash
kubectl get replicasets -n tp-deployment
```
```
kubectl get deployment web-deployment -n tp-deployment -o yaml
```



> ğŸ“Œ Le ReplicaSet reste le mÃªme : Kubernetes ajuste le nombre de Pods pour correspondre.
> ğŸ“Œ Chercher le nombre de rÃ©plicas Ã  2 dans dÃ©ployment

---

## ğŸŸ¦ Ã‰tape 6 â€“ Mettre Ã  jour lâ€™image dans le Deployment

### âœ… Modifier `deployment.yaml` :
```yaml
image: nginx:1.25
```

### ğŸ” Appliquer la mise Ã  jour :
```bash
kubectl apply -f deployment.yaml
```

### ğŸ” Observer :
```bash
kubectl get replicasets -n tp-deployment
```
```
kubectl get pods -n tp-deployment
```

ğŸ’¬ **Impact observÃ©** :
- Un **nouveau ReplicaSet est crÃ©Ã©**
- Les anciens Pods sont supprimÃ©s progressivement (rolling update)
- Le nouveau ReplicaSet prend le relai

---

## ğŸŸ¦ Ã‰tape 7 â€“ Suivre le dÃ©roulement de la mise Ã  jour

```bash
kubectl rollout status deployment web-deployment -n tp-deployment
```

ğŸ“Œ Permet de voir lâ€™Ã©volution du rolling update en temps rÃ©el.

---

## ğŸŸ¦ Ã‰tape 8 â€“ Rollback si besoin (optionnel)

```bash
kubectl rollout undo deployment web-deployment -n tp-deployment
```
```
kubectl get replicasets -n tp-deployment
```
```
kubectl get pods -n tp-deployment
```

ğŸ“Œ Revenir Ã  lâ€™image prÃ©cÃ©dente en une seule commande et c'est l'ancien replicaset qui est actif.

---

## â“ Questions de fin de TP â€“ Deployment, scalabilitÃ© & mises Ã  jour

## ğŸ§  Q1 â€“ Analyse comportementale :

Lors dâ€™une mise Ã  jour de lâ€™image dans un Deployment, pourquoi Kubernetes crÃ©e-t-il un nouveau ReplicaSet au lieu de modifier lâ€™existant ?
Quel avantage ce comportement apporte-t-il dans un contexte de production ?

## ğŸ’¬ Q2 â€“ ScÃ©nario DevOps :

Imaginez que vous ayez dÃ©clenchÃ© une mise Ã  jour vers une image incorrecte en production.
Quels objets devez-vous surveiller pour dÃ©tecter un incident rapidement, et comment Kubernetes vous permet-il de revenir rapidement Ã  une version stable ?



## âœ… RÃ©capitulatif

| Action                        | Comportement observÃ©                                 |
|-------------------------------|------------------------------------------------------|
| CrÃ©ation de Deployment        | CrÃ©e un ReplicaSet et les Pods associÃ©s              |
| Suppression de Pod            | RecrÃ©Ã© automatiquement par le ReplicaSet             |
| Scaling (up/down)             | Pods ajustÃ©s automatiquement                         |
| Mise Ã  jour de lâ€™image        | Nouveau ReplicaSet crÃ©Ã©, rolling update appliquÃ©     |
| Rollback                      | Retour automatique Ã  la version prÃ©cÃ©dente           |
| Nommage Pods/RS/Deployment    | Pods liÃ©s Ã  un RS, lui-mÃªme liÃ© au Deployment        |


