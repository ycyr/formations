# ğŸ§ª TP â€“ ConfigMaps & Secrets dans Kubernetes

## ğŸ¯ Objectifs pÃ©dagogiques

- CrÃ©er et manipuler un ConfigMap
- CrÃ©er et utiliser un Secret
- Injecter des variables dans un Pod (env et fichiers)
- Comprendre le stockage et dÃ©codage des secrets
- Observer et tester dans un conteneur

---

## ğŸŸ¦ Ã‰tape 1 â€“ CrÃ©er un namespace de travail

```bash
kubectl create namespace tp-config
```

---

## ğŸŸ¦ Ã‰tape 2 â€“ CrÃ©er un ConfigMap

### âœ… configmap.yaml
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: tp-config
data:
  APP_ENV: "staging"
  MAX_USERS: "200"
  config.properties: |
    feature.enabled=true
    api.timeout=30
```

```bash
kubectl apply -f configmap.yaml
```

---

## ğŸŸ¦ Ã‰tape 3 â€“ CrÃ©er un Secret

### âœ… secret.yaml
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secret
  namespace: tp-config
type: Opaque
data:
  DB_USER: YWRtaW4=        # admin
  DB_PASS: c2VjcmV0       # secret
```

```bash
kubectl apply -f secret.yaml
```

---

## ğŸŸ¦ Ã‰tape 4 â€“ Lire un Secret depuis la ligne de commande

```bash
kubectl get secret app-secret -n tp-config -o yaml
```

### ğŸ” DÃ©coder une valeur avec `base64 -d`

```bash
echo YWRtaW4= | base64 -d  
```

---

## ğŸŸ¦ Ã‰tape 5 â€“ CrÃ©er un Pod avec ConfigMap + Secret injectÃ©s

### âœ… pod.yaml
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: config-test
  namespace: tp-config
spec:
  containers:
  - name: alpine
    image: alpine
    command: [ "sleep", "3600" ]
    env:
    - name: APP_ENV
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: APP_ENV
    - name: DB_USER
      valueFrom:
        secretKeyRef:
          name: app-secret
          key: DB_USER
    volumeMounts:
    - name: config-volume
      mountPath: /etc/config
    - name: secret-volume
      mountPath: /etc/secret
  volumes:
  - name: config-volume
    configMap:
      name: app-config
      items:
      - key: config.properties
        path: config.properties
  - name: secret-volume
    secret:
      secretName: app-secret
```

```bash
kubectl apply -f pod.yaml
kubectl get pod config-test -n tp-config
```

---

## ğŸŸ¦ Ã‰tape 6 â€“ Explorer le Pod

```bash
kubectl exec -it config-test -n tp-config -- sh
```

### ğŸ” Depuis le shell dans le conteneur :

```sh
# Voir les variables d'environnement injectÃ©es
echo $APP_ENV
echo $DB_USER

# Lire les fichiers montÃ©s depuis ConfigMap
cat /etc/config/config.properties

# Lire les fichiers montÃ©s depuis Secret
cat /etc/secret/DB_USER
cat /etc/secret/DB_PASS
```

ğŸ’¡ Les fichiers de Secret sont en lecture seule, format texte.

---

## ğŸŸ¦ Ã‰tape 7 â€“ Nettoyage (optionnel)

```bash
kubectl delete namespace tp-config
```

---

## âœ… RÃ©capitulatif

| Ressource  | Injection par ENV | Injection par Fichier | EncodÃ© base64 |
|------------|-------------------|------------------------|----------------|
| ConfigMap  | âœ… Oui             | âœ… Oui                 | âŒ Non         |
| Secret     | âœ… Oui             | âœ… Oui                 | âœ… Oui         |

---

## â“ Questions de fin de TP â€“ ConfigMaps & Secrets

### ğŸ§  Q1 â€“ ComprÃ©hension technique :

Quelle est la diffÃ©rence fondamentale entre un fichier montÃ© depuis un Secret et une variable dâ€™environnement injectÃ©e depuis ce mÃªme Secret ?
Dans quel cas lâ€™un est prÃ©fÃ©rable Ã  lâ€™autre, en termes de sÃ©curitÃ© et dâ€™usage dans une application ?

### ğŸ’¬ Q2 â€“ Pratique de sÃ©curitÃ© :

En production, pourquoi ne peut-on pas considÃ©rer les Secrets Kubernetes comme vÃ©ritablement sÃ©curisÃ©s par dÃ©faut ?
Quelles prÃ©cautions supplÃ©mentaires devrions-nous mettre en place pour renforcer leur confidentialitÃ© ?
