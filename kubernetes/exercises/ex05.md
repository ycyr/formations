# ğŸ§ª TP â€“ Services Kubernetes avec lâ€™image `stefanprodan/podinfo`

## ğŸ¯ Objectifs

- DÃ©ployer un Pod avec lâ€™image `podinfo`
- CrÃ©er diffÃ©rents types de Services Kubernetes
- Tester les accÃ¨s rÃ©seau et la rÃ©solution DNS
- Comprendre les diffÃ©rences entre ClusterIP, NodePort et LoadBalancer

---

## ğŸŸ¦ Ã‰tape 1 â€“ CrÃ©er le namespace

```bash
kubectl create namespace tp-services
```

---

## ğŸŸ¦ Ã‰tape 2 â€“ DÃ©ployer le Pod `podinfo`

### âœ… `pod.yaml`
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: podinfo
  namespace: tp-services
  labels:
    app: podinfo
spec:
  containers:
  - name: podinfo
    image: stefanprodan/podinfo:6.8.0
    ports:
    - containerPort: 9898
```

```bash
kubectl apply -f pod.yaml
```

---

## ğŸŸ¦ Ã‰tape 3 â€“ CrÃ©er un Service de type `ClusterIP`

### âœ… `service-clusterip.yaml`
```yaml
apiVersion: v1
kind: Service
metadata:
  name: podinfo-svc
  namespace: tp-services
spec:
  selector:
    app: podinfo
  ports:
  - port: 80
    targetPort: 9898
    protocol: TCP
```

```bash
kubectl apply -f service-clusterip.yaml
kubectl get svc -n tp-services
```

---

## ğŸŸ¦ Ã‰tape 4 â€“ Tester depuis un Pod dans le mÃªme namespace

```bash
kubectl run curl --rm -it --image=curlimages/curl --namespace=tp-services -- sh
```

Depuis le shell :
```bash
curl http://podinfo-svc
```

ğŸ“Œ RÃ©sultat attendu :
RÃ©ponse JSON du service `podinfo` (version, hostname, etc.)

---

## ğŸŸ¦ Ã‰tape 5 â€“ CrÃ©er un Service `NodePort`

### âœ… `service-nodeport.yaml`
```yaml
apiVersion: v1
kind: Service
metadata:
  name: podinfo-nodeport
  namespace: tp-services
spec:
  type: NodePort
  selector:
    app: podinfo
  ports:
  - port: 80
    targetPort: 9898
    nodePort: 30080
```

```bash
kubectl apply -f service-nodeport.yaml
kubectl get svc -n tp-services
```

---

### ğŸ” Tester depuis lâ€™extÃ©rieur :

```bash
curl http://<IP_NODE>:30080
```

ğŸ’¡ Utilise ` kubectl get nodes -o wide` cherche INTERNAL-IP

---

## ğŸŸ¦ Ã‰tape 6 â€“ CrÃ©er un Service `LoadBalancer` (optionnel - cloud only)

### âœ… `service-lb.yaml`
```yaml
apiVersion: v1
kind: Service
metadata:
  name: podinfo-lb
  namespace: tp-services
spec:
  type: LoadBalancer
  selector:
    app: podinfo
  ports:
  - port: 80
    targetPort: 9898
```

```bash
kubectl apply -f service-lb.yaml
kubectl get svc -n tp-services
```

Une fois `EXTERNAL-IP` disponible :
```bash
curl http://<EXTERNAL-IP>
```

---

## ğŸŸ¦ Ã‰tape 7 â€“ RÃ©solution DNS entre namespaces

### âœ… CrÃ©er un autre namespace de test

```bash
kubectl create namespace test-dns
```

### âœ… Lancer un Pod client

```bash
kubectl run dns-client --rm -it --image=wbitt/network-multitool  --namespace=test-dns -- /bin/bash
```

---

### ğŸ” Tester la rÃ©solution DNS  avec curl

```bash
curl podinfo-svc               # âŒ Ne marche pas (nom court, mauvais namespace)
curl  podinfo-svc.tp-services.svc   # âœ… RÃ©sout correctement
curl podinfo-svc.tp-services.svc.cluster.local   # âœ… RÃ©sout aussi
```


### Regarder la configuration DNS de votre 

```bash
cat /etc/resolv.conf
```


Que pouvez en dÃ©duire ?

---

## âœ… RÃ©sumÃ© final

| Type de Service | Interne | Externe | DNS                      | Testable avec...           |
|------------------|---------|---------|---------------------------|-----------------------------|
| ClusterIP        | âœ…       | âŒ       | `svc.namespace`           | `curl` depuis un Pod        |
| NodePort         | âœ…       | âœ…       | `svc.namespace`           | `curl` via IP du Node       |
| LoadBalancer     | âœ…       | âœ…       | `svc.namespace`           | `curl` via EXTERNAL-IP      |

---

ğŸ“Œ Image utilisÃ©e : [`stefanprodan/podinfo:6.8.0`](https://hub.docker.com/r/stefanprodan/podinfo)  
Port utilisÃ© dans le conteneur : `9898`  
Port exposÃ© par les Services : `80`

