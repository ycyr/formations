---

# ğŸ› ï¸ TP Ansible Ad-Hoc - Modules Setup, File, Copy, Command, Shell, Fetch

---

## ğŸ¯ Objectifs pÃ©dagogiques

Manipuler les modules ad-hoc :
- `setup`
- `file`
- `copy`
- `command`
- `shell`
- `fetch`
- Utiliser `ansible-doc`

---

# ğŸ“‹ Structure par Module avec 2-3 Exercices chacun

ğŸ–¥ï¸ Inventaire utilisÃ© (fichier `hosts`)

```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

ğŸ–¥ï¸ Fichier configuration utilisÃ© (`ansible.cfg`)

```ini
[defaults]
inventory = hosts
host_key_checking = False
```

---

## 1ï¸âƒ£ Module `setup` : ğŸ“œ DÃ©couverte des facts

ğŸ”¹ **Exercice 1 :** Lister tous les facts d'une machine Ubuntu.

```bash
ansible ubuntu1 -m setup
```

ğŸ”¹ **Exercice 2 :** Filtrer pour n'afficher que le fait `ansible_os_family`.

```bash
ansible ubuntu1 -m setup -a "filter=ansible_os_family"
```

ğŸ”¹ **Exercice 3 :** Filtrer pour ne rÃ©cupÃ©rer que le fait `ansible_processor`.

```bash
ansible ubuntu1 -m setup -a "filter=ansible_processor"
```

---

## 2ï¸âƒ£ Module `file` : ğŸ“ Manipulation de fichiers et rÃ©pertoires

ğŸ”¹ **Exercice 1 :** CrÃ©er un rÃ©pertoire `/tmp/ansible_tp`.

```bash
ansible linux -m file -a "path=/tmp/ansible_tp state=directory mode=0755"
```

ğŸ”¹ **Exercice 2 :** CrÃ©er un fichier vide `/tmp/ansible_tp/test.txt`.

```bash
ansible linux -m file -a "path=/tmp/ansible_tp/test.txt state=touch mode=0644"
```

ğŸ”¹ **Exercice 3 :** Supprimer le fichier `/tmp/ansible_tp/test.txt`.

```bash
ansible linux -m file -a "path=/tmp/ansible_tp/test.txt state=absent"
```

---

## 3ï¸âƒ£ Module `copy` : ğŸ“„ Copier des fichiers

ğŸ”¹ **Exercice 1 :** Copier un fichier `hello.txt` local vers `/tmp/ansible_tp/hello.txt` sur tous les serveurs.

```bash
ansible linux -m copy -a "src=hello.txt dest=/tmp/ansible_tp/hello.txt"
```

ğŸ”¹ **Exercice 2 :** Copier un fichier et **forcer la permission** Ã  `0600`.

```bash
ansible linux -m copy -a "src=hello.txt dest=/tmp/ansible_tp/hello-secured.txt mode=0600"
```

ğŸ”¹ **Exercice 3 :** Copier un script shell `script.sh` et le rendre exÃ©cutable (`mode=0755`).

```bash
ansible linux -m copy -a "src=script.sh dest=/tmp/ansible_tp/script.sh mode=0755"
```

---

## 4ï¸âƒ£ Module `command` : ğŸ–¥ï¸ Lancer des commandes simples

ğŸ”¹ **Exercice 1 :** Lister les fichiers dans `/tmp/ansible_tp`.

```bash
ansible linux -m command -a "ls -l /tmp/ansible_tp"
```

ğŸ”¹ **Exercice 2 :** Afficher le contenu de `/etc/os-release`.

```bash
ansible linux -m command -a "cat /etc/os-release"
```

ğŸ”¹ **Exercice 3 :** Voir l'espace disque disponible.

```bash
ansible linux -m command -a "df -h"
```

---

## 5ï¸âƒ£ Module `shell` : ğŸš ExÃ©cuter des commandes shell complexes

ğŸ”¹ **Exercice 1 :** Ajouter une ligne dans un fichier (avec redirection `>>`).

```bash
ansible linux -m shell -a "echo 'Formation Ansible TP' >> /tmp/ansible_tp/README.txt"
```

ğŸ”¹ **Exercice 2 :** CrÃ©er plusieurs fichiers d'un coup.

```bash
ansible linux -m shell -a "touch /tmp/ansible_tp/fichier{1..5}.txt"
```

ğŸ”¹ **Exercice 3 :** Compresser tous les fichiers dans `/tmp/ansible_tp` en un `.tar.gz`.

```bash
ansible linux -m shell -a "tar czf /tmp/ansible_tp/backup.tar.gz /tmp/ansible_tp/*.txt"
```

---

## 6ï¸âƒ£ Module `fetch` : ğŸ›¬ RÃ©cupÃ©rer des fichiers distants

ğŸ”¹ **Exercice 1 :** RÃ©cupÃ©rer `/tmp/ansible_tp/README.txt` localement.

```bash
ansible linux -m fetch -a "src=/tmp/ansible_tp/README.txt dest=/tmp/fetch_results/ flat=yes"
```

ğŸ”¹ **Exercice 2 :** RÃ©cupÃ©rer tous les fichiers `.txt` de `/tmp/ansible_tp`.

```bash
ansible linux -m fetch -a "src=/tmp/ansible_tp/fichier1.txt dest=/tmp/fetch_results/ flat=yes"
```

ğŸ”¹ **Exercice 3 :** RÃ©cupÃ©rer le fichier `backup.tar.gz`.

```bash
ansible linux -m fetch -a "src=/tmp/ansible_tp/backup.tar.gz dest=/tmp/fetch_results/ flat=yes"
```

---

## 7ï¸âƒ£ Documentation `ansible-doc` : ğŸ“š

ğŸ”¹ **Exercice 1 :** Afficher la documentation du module `setup`.

```bash
ansible-doc setup
```

ğŸ”¹ **Exercice 2 :** Lire la documentation du module `file`.

```bash
ansible-doc file
```

ğŸ”¹ **Exercice 3 :** Chercher un module contenant "package" pour installer un paquet.

```bash
ansible-doc -s package
```

---

# ğŸ”¥ RÃ©fÃ©rences

[https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html](https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html)

