---

# 🛠️ TP Ansible Ad-Hoc - Modules Setup, File, Copy, Command, Shell, Fetch

---

## 🎯 Objectifs pédagogiques

Manipuler les modules ad-hoc :
- `setup`
- `file`
- `copy`
- `command`
- `shell`
- `fetch`
- Utiliser `ansible-doc`

---

# 📋 Structure par Module avec 2-3 Exercices chacun

🖥️ Inventaire utilisé (fichier `hosts`)

```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

🖥️ Fichier configuration utilisé (`ansible.cfg`)

```ini
[defaults]
inventory = hosts
host_key_checking = False
```

---

## 1️⃣ Module `setup` : 📜 Découverte des facts

🔹 **Exercice 1 :** Lister tous les facts d'une machine Ubuntu.

```bash
ansible ubuntu1 -m setup
```

🔹 **Exercice 2 :** Filtrer pour n'afficher que le fait `ansible_os_family`.

```bash
ansible ubuntu1 -m setup -a "filter=ansible_os_family"
```

🔹 **Exercice 3 :** Filtrer pour ne récupérer que le fait `ansible_processor`.

```bash
ansible ubuntu1 -m setup -a "filter=ansible_processor"
```

---

## 2️⃣ Module `file` : 📁 Manipulation de fichiers et répertoires

🔹 **Exercice 1 :** Créer un répertoire `/tmp/ansible_tp`.

```bash
ansible linux -m file -a "path=/tmp/ansible_tp state=directory mode=0755"
```

🔹 **Exercice 2 :** Créer un fichier vide `/tmp/ansible_tp/test.txt`.

```bash
ansible linux -m file -a "path=/tmp/ansible_tp/test.txt state=touch mode=0644"
```

🔹 **Exercice 3 :** Supprimer le fichier `/tmp/ansible_tp/test.txt`.

```bash
ansible linux -m file -a "path=/tmp/ansible_tp/test.txt state=absent"
```

---

## 3️⃣ Module `copy` : 📄 Copier des fichiers

🔹 **Exercice 1 :** Copier un fichier `hello.txt` local vers `/tmp/ansible_tp/hello.txt` sur tous les serveurs.

```bash
ansible linux -m copy -a "src=hello.txt dest=/tmp/ansible_tp/hello.txt"
```

🔹 **Exercice 2 :** Copier un fichier et **forcer la permission** à `0600`.

```bash
ansible linux -m copy -a "src=hello.txt dest=/tmp/ansible_tp/hello-secured.txt mode=0600"
```

🔹 **Exercice 3 :** Copier un script shell `script.sh` et le rendre exécutable (`mode=0755`).

```bash
ansible linux -m copy -a "src=script.sh dest=/tmp/ansible_tp/script.sh mode=0755"
```

---

## 4️⃣ Module `command` : 🖥️ Lancer des commandes simples

🔹 **Exercice 1 :** Lister les fichiers dans `/tmp/ansible_tp`.

```bash
ansible linux -m command -a "ls -l /tmp/ansible_tp"
```

🔹 **Exercice 2 :** Afficher le contenu de `/etc/os-release`.

```bash
ansible linux -m command -a "cat /etc/os-release"
```

🔹 **Exercice 3 :** Voir l'espace disque disponible.

```bash
ansible linux -m command -a "df -h"
```

---

## 5️⃣ Module `shell` : 🐚 Exécuter des commandes shell complexes

🔹 **Exercice 1 :** Ajouter une ligne dans un fichier (avec redirection `>>`).

```bash
ansible linux -m shell -a "echo 'Formation Ansible TP' >> /tmp/ansible_tp/README.txt"
```

🔹 **Exercice 2 :** Créer plusieurs fichiers d'un coup.

```bash
ansible linux -m shell -a "touch /tmp/ansible_tp/fichier{1..5}.txt"
```

🔹 **Exercice 3 :** Compresser tous les fichiers dans `/tmp/ansible_tp` en un `.tar.gz`.

```bash
ansible linux -m shell -a "tar czf /tmp/ansible_tp/backup.tar.gz /tmp/ansible_tp/*.txt"
```

---

## 6️⃣ Module `fetch` : 🛬 Récupérer des fichiers distants

🔹 **Exercice 1 :** Récupérer `/tmp/ansible_tp/README.txt` localement.

```bash
ansible linux -m fetch -a "src=/tmp/ansible_tp/README.txt dest=/tmp/fetch_results/ flat=yes"
```

🔹 **Exercice 2 :** Récupérer tous les fichiers `.txt` de `/tmp/ansible_tp`.

```bash
ansible linux -m fetch -a "src=/tmp/ansible_tp/fichier1.txt dest=/tmp/fetch_results/ flat=yes"
```

🔹 **Exercice 3 :** Récupérer le fichier `backup.tar.gz`.

```bash
ansible linux -m fetch -a "src=/tmp/ansible_tp/backup.tar.gz dest=/tmp/fetch_results/ flat=yes"
```

---

## 7️⃣ Documentation `ansible-doc` : 📚

🔹 **Exercice 1 :** Afficher la documentation du module `setup`.

```bash
ansible-doc setup
```

🔹 **Exercice 2 :** Lire la documentation du module `file`.

```bash
ansible-doc file
```

🔹 **Exercice 3 :** Chercher un module contenant "package" pour installer un paquet.

```bash
ansible-doc -s package
```

---

# 🔥 Références

[https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html](https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html)

