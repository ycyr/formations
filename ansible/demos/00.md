---

### ğŸ” **Slide 1 â€“ Connexion SSH sans mot de passe**
Objectif :  
â¡ï¸ Permettre Ã  Ansible (agentless) de se connecter **sans mot de passe** Ã  ses cibles via **SSH**  
â¡ï¸ Ã‰tablir une **relation de confiance** entre le nÅ“ud de contrÃ´le (`ubuntu-c`) et les hÃ´tes cibles (`ubuntu1`, `centos1`, etc.)

---

### ğŸ”„ **Slide 2 â€“ Comment fonctionne SSH**
Ã‰tapes dâ€™une connexion SSH :
1. Ã‰change de versions du protocole
2. NÃ©gociation cryptographique (Diffie-Hellman)
3. VÃ©rification de lâ€™empreinte (fingerprint)
4. Ã‰change de clÃ©s de session
5. Ouverture dâ€™un canal chiffrÃ©
6. Authentification (mot de passe ou clÃ© privÃ©e)

---

### ğŸ“‚ **Slide 3 â€“ Dossier .ssh et known_hosts**
- Les empreintes des hÃ´tes sont enregistrÃ©es dans `~/.ssh/known_hosts`
- Visible avec :
```bash
ls -a ~/.ssh
cat ~/.ssh/known_hosts
```
- Chaque hÃ´te peut apparaÃ®tre sous deux formes : **nom dâ€™hÃ´te** et **adresse IP**

---

### ğŸ”‘ **Slide 4 â€“ Passage aux clÃ©s SSH**
ProblÃ¨me : entrer un mot de passe manuellement Ã  chaque connexion  
Solution : **authentification par clÃ© SSH**

Sur le nÅ“ud de contrÃ´le :
```bash
ssh-keygen
```
- GÃ©nÃ¨re une paire de clÃ©s publique/privÃ©e dans `~/.ssh`
- ClÃ© publique â†’ `id_rsa.pub`
- ClÃ© privÃ©e â†’ `id_rsa`

---

### ğŸ“¤ **Copie de la clÃ© avec `ssh-copy-id`**
Pour installer automatiquement la clÃ© publique :
```bash
ssh-copy-id ansible@ubuntu1
```
âœ… GÃ¨re aussi les permissions sur `.ssh/authorized_keys`

RÃ©sultat :
- Plus de saisie de mot de passe nÃ©cessaire
- Canal sÃ©curisÃ© + authentification automatique

---

### ğŸ”„ **Automatiser avec `sshpass`**
Installer `sshpass` :
```bash
sudo apt update
sudo apt install sshpass
```
CrÃ©er un fichier mot de passe :
```bash
echo password > password.txt
```

---

### ğŸ” **Script automatisÃ© pour tous les hÃ´tes**
CrÃ©er le fichier script-ssh.sh
```bash
#!/bin/bash
for user in ansible root; do
  for os in ubuntu centos; do
    for i in 1 2 3; do
      sshpass -f password.txt ssh-copy-id \
        -o StrictHostKeyChecking=no \
        ${user}@${os}${i}
    done
  done
done
```

ğŸ§¼ Nettoyage :
```bash
bash -x ./script-ssh.sh
rm password.txt
```

---

### âœ… **VÃ©rification avec Ansible**
Test avec le module `ping` :
```bash
ansible -i ubuntu1,ubuntu2,ubuntu3,centos1,centos2,centos3 all -m ping
```

RÃ©sultat :
- RÃ©ponse `pong` si la connexion fonctionne
- Confirmation que la connectivitÃ© SSH sans mot de passe est bien en place

---

### ğŸ”„ **Ã€ retenir**
- SSH est la **colonne vertÃ©brale dâ€™Ansible**
- ClÃ©s publiques/privÃ©es Ã©vitent les mots de passe
- `ssh-copy-id` + `sshpass` = gain de temps Ã©norme
- PossibilitÃ© de vÃ©rifier rapidement avec `ansible -m ping`

