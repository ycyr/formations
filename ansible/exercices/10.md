
---

## ğŸ§ª TP â€“ Lookup Plugins & Callback Plugins dans Ansible

### ğŸ¯ Objectifs pÃ©dagogiques
- Utiliser un plugin de type **lookup** (`file`, `env`, `password`, etc.)
- Activer un plugin **callback** (`profile_tasks`, `yaml`, etc.)
- Comprendre lâ€™impact sur lâ€™exÃ©cution et lâ€™affichage

---

### ğŸ—‚ï¸ Inventaire `hosts`

CrÃ©ez un fichier `hosts` avec ce contenu :

```
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

---

## ğŸ”¹ Ã‰tape 1 â€” Utilisation du plugin lookup `file`

### ğŸ“ Fichier secret local

CrÃ©ez un fichier : `/etc/ansible/secrets/db_pass.txt` contenant :

```txt
SuperSecretPassword123
```

### ğŸ“˜ Playbook `lookup_file_demo.yml`

```yaml
- name: DÃ©monstration du plugin lookup
  hosts: ubuntu1
  gather_facts: false
  tasks:
    - name: Lire un mot de passe depuis un fichier
      debug:
        msg: "Mot de passe : {{ lookup('file', '/etc/ansible/secrets/db_pass.txt') }}"
```

### ğŸš€ Lancer le playbook :

```bash
ansible-playbook -i hosts lookup_file_demo.yml
```

---

## ğŸ”¹ Ã‰tape 2 â€” Utilisation du plugin `profile_tasks`

### âš™ï¸ Fichier `ansible.cfg`

```ini
[defaults]
stdout_callback = profile_tasks
```

### ğŸ§ª Playbook `callback_profile_demo.yml`

```yaml
- name: DÃ©mo callback plugin profile_tasks
  hosts: ubuntu1
  gather_facts: false
  tasks:
    - name: TÃ¢che rapide
      command: echo "Hello"

    - name: TÃ¢che lente
      command: sleep 3
```

### ğŸš€ Lancer le playbook :

```bash
ansible-playbook -i hosts callback_profile_demo.yml
```

---

## ğŸ”¹ Ã‰tape 3 (optionnelle) â€” Utiliser plusieurs `lookup`

Modifiez le playbook prÃ©cÃ©dent :

```yaml
    - name: Lire une variable dâ€™environnement
      debug:
        msg: "HOME = {{ lookup('env','HOME') }}"

    - name: GÃ©nÃ©rer un mot de passe temporaire
      debug:
        msg: "Mot de passe temporaire : {{ lookup('password', '/tmp/temp_passfile chars=ascii_letters,digits length=16') }}"
```

---

