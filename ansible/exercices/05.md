

---

## ğŸ§ª TP â€” Utilisation des Facts dans Ansible

### ğŸ¯ Objectifs pÃ©dagogiques :
- AccÃ©der aux facts dans un playbook
- Utiliser des facts avec une condition `when`
- CrÃ©er et exploiter un *custom fact*

---

### ğŸ“ Structure recommandÃ©e

```
tp4_facts/
â”œâ”€â”€ playbook_facts.yml
â”œâ”€â”€ custom_fact.sh
â”œâ”€â”€ hosts.txt
```

---

### ğŸ§© Ã‰tape 1 â€” AccÃ©der aux facts classiques

`playbook_facts.yml` :
```yaml
- name: TP4 - AccÃ¨s aux facts
  hosts: linux
  gather_facts: true
  become: true

  tasks:
    - name: Afficher l'adresse IP de l'interface principale
      debug:
        msg: "IP de l'interface par dÃ©faut : {{ ansible_default_ipv4.address }}"

    - name: Afficher le systÃ¨me d'exploitation
      debug:
        msg: "OS : {{ ansible_distribution }} {{ ansible_distribution_version }}"
```

âœ… ExÃ©cutez :
```bash
ansible-playbook -i hosts.txt playbook_facts.yml
```

---

### ğŸ§© Ã‰tape 2 â€” Utiliser les facts avec `when`

Ajoutez ceci dans les tÃ¢ches :
```yaml
    - name: Message personnalisÃ© pour CentOS
      debug:
        msg: "Je suis sur CentOS"
      when: ansible_distribution == "CentOS"
```

---

### ğŸ§© Ã‰tape 3 â€” CrÃ©er un *custom fact*

1. CrÃ©ez un script `/etc/ansible/facts.d/custom.sh` sur tous les hÃ´tes :

```bash
#!/bin/bash
echo '{ "custom_role": "webserver", "is_training_vm": true }'
```

âœ… Copiez avec un ad-hoc :
```bash
ansible linux -i hosts.txt -m file -a "path=/etc/ansible/facts.d state=directory mode=0755"
ansible linux -i hosts.txt -m copy -a "src=custom_fact.sh dest=/etc/ansible/facts.d/custom.sh mode=0755"
```

2. Relancez le playbook avec `gather_facts: true`.

---

### ğŸ§© Ã‰tape 4 â€” Exploiter un *custom fact*

Ajoutez ceci Ã  la fin des tÃ¢ches :

```yaml
    - name: Lire la custom fact
      debug:
        msg: "RÃ´le dÃ©fini dans la custom fact : {{ ansible_local.custom.custom_role }}"

    - name: VÃ©rifier si c'est une machine de formation
      debug:
        msg: "Cette VM est destinÃ©e Ã  la formation"
      when: ansible_local.custom.is_training_vm | bool
```

