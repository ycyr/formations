

---

## ğŸ§ª TP â€” Utilisation de register

## ğŸ“ Fichier dâ€™inventaire `hosts`

```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

---

## ğŸ§ª Objectif du TP

- Comprendre `register`
- DÃ©couvrir les donnÃ©es enregistrÃ©es
- Utiliser `when` conditionnellement en fonction du `register`
- Manipuler les modules `file` et `stat`

---

## ğŸ“„ Ã‰tape 1 â€” CrÃ©er un fichier et capturer lâ€™Ã©tat

ğŸ“ `01_register_stat.yml`

```yaml
- name: TP - DÃ©couverte de register et stat
  hosts: linux
  gather_facts: false
  become: true

  tasks:
    - name: CrÃ©er un fichier vide /tmp/ansible_demo.txt
      file:
        path: /tmp/ansible_demo.txt
        state: touch

    - name: VÃ©rifier les infos du fichier crÃ©Ã©
      stat:
        path: /tmp/ansible_demo.txt
      register: resultat_stat

    - name: Afficher les infos du fichier
      debug:
        var: resultat_stat
```

â–¶ï¸ `ansible-playbook -i hosts 01_register_stat.yml`

---

## ğŸ“„ Ã‰tape 2 â€” Conditionner une tÃ¢che avec `when`

ğŸ“ `02_condition_when.yml`

```yaml
- name: TP - Utilisation de when avec register
  hosts: linux
  gather_facts: false
  become: true

  tasks:
    - name: VÃ©rifier si le fichier existe
      stat:
        path: /tmp/ansible_demo.txt
      register: fichier_info

    - name: Supprimer le fichier sâ€™il existe
      file:
        path: /tmp/ansible_demo.txt
        state: absent
      when: fichier_info.stat.exists

    - name: CrÃ©er un nouveau fichier si lâ€™ancien a Ã©tÃ© supprimÃ©
      file:
        path: /tmp/ansible_demo.txt
        state: touch
      when: not fichier_info.stat.exists
```

â–¶ï¸ `ansible-playbook -i hosts 02_condition_when.yml`

---

## ğŸ“„ Ã‰tape 3 â€” DÃ©cision selon le type (fichier ou rÃ©pertoire)

ğŸ“ `03_when_type.yml`

```yaml
- name: TP - DÃ©tection de type avec register
  hosts: linux
  gather_facts: false
  become: true

  tasks:
    - name: CrÃ©er un rÃ©pertoire
      file:
        path: /tmp/ansible_demo_dir
        state: directory

    - name: VÃ©rifier si câ€™est un fichier ou un dossier
      stat:
        path: /tmp/ansible_demo_dir
      register: verif_type

    - name: Message si câ€™est un dossier
      debug:
        msg: "Ceci est un dossier"
      when: verif_type.stat.isdir

    - name: Message si câ€™est un fichier
      debug:
        msg: "Ceci est un fichier"
      when: verif_type.stat.isreg
```

â–¶ï¸ `ansible-playbook -i hosts 03_when_type.yml`

---
