

---

## ğŸ§ª TP â€” Utilisation des boucles

## ğŸ”§ Fichier dâ€™inventaire (`hosts`)

```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

---

## ğŸ§ª Ã‰tape par Ã‰tape â€” Boucles

### ğŸŒ€ 1. `with_items`

ğŸ“„ `01_with_items.yml`

```yaml
- name: Exemple avec with_items
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Afficher chaque fruit
      debug:
        msg: "Fruit : {{ item }}"
      with_items:
        - pomme
        - banane
        - cerise
```

â–¶ï¸ `ansible-playbook -i hosts 01_with_items.yml`

---

### ğŸ§® 2. `with_dict`

ğŸ“„ `02_with_dict.yml`

```yaml
- name: Exemple avec with_dict
  hosts: localhost
  gather_facts: false

  vars:
    utilisateurs:
      alice: "admin"
      bob: "dev"
      claire: "qa"

  tasks:
    - name: Afficher utilisateur et rÃ´le
      debug:
        msg: "{{ item.key }} est {{ item.value }}"
      with_dict: "{{ utilisateurs }}"
```

â–¶ï¸ `ansible-playbook -i hosts 02_with_dict.yml`

---

### ğŸ§¬ 3. `with_subelements`

ğŸ“„ `03_with_subelements.yml`

```yaml
- name: Exemple avec with_subelements
  hosts: localhost
  gather_facts: false

  vars:
    utilisateurs:
      - name: alice
        groupes: ["admin", "dev"]
      - name: bob
        groupes: ["qa"]

  tasks:
    - name: Afficher utilisateur et ses groupes
      debug:
        msg: "{{ item.0.name }} appartient au groupe {{ item.1 }}"
      with_subelements:
        - "{{ utilisateurs }}"
        - groupes
```

â–¶ï¸ `ansible-playbook -i hosts 03_with_subelements.yml`

---

### ğŸ”€ 4. `with_nested`

ğŸ“„ `04_with_nested.yml`

```yaml
- name: Exemple avec with_nested
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Afficher chaque combinaison
      debug:
        msg: "OS: {{ item.0 }} / Version: {{ item.1 }}"
      with_nested:
        - [ "Ubuntu", "CentOS" ]
        - [ "20.04", "8", "9" ]
```

â–¶ï¸ `ansible-playbook -i hosts 04_with_nested.yml`

---

### ğŸ§© 5. `with_together`

ğŸ“„ `05_with_together.yml`

```yaml
- name: Exemple avec with_together
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Associer noms et mÃ©tiers
      debug:
        msg: "{{ item.0 }} travaille comme {{ item.1 }}"
      with_together:
        - [ "Paul", "Julie", "Marc" ]
        - [ "Docteur", "IngÃ©nieure", "Professeur" ]
```

â–¶ï¸ `ansible-playbook -i hosts 05_with_together.yml`

---

### ğŸ² 6. `with_random_choice`

ğŸ“„ `06_with_random.yml`

```yaml
- name: Exemple avec with_random_choice
  hosts: localhost
  gather_facts: false

  tasks:
    - name: SÃ©lectionner une couleur au hasard
      debug:
        msg: "Couleur choisie : {{ item }}"
      with_random_choice:
        - rouge
        - vert
        - bleu
```

â–¶ï¸ `ansible-playbook -i hosts 06_with_random.yml`

---

### â™»ï¸ 7. `loop` avec `list`

ğŸ“„ `07_loop_list.yml`

```yaml
- name: Exemple avec loop simple
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Afficher des nombres
      debug:
        msg: "Nombre : {{ item }}"
      loop: [1, 2, 3, 4]
```

â–¶ï¸ `ansible-playbook -i hosts 07_loop_list.yml`

---

### ğŸ§¾ 8. `loop` avec `dict`

ğŸ“„ `08_loop_dict.yml`

```yaml
- name: Exemple avec loop sur dictionnaire
  hosts: localhost
  gather_facts: false

  vars:
    logiciels:
      nginx: "serveur web"
      mysql: "base de donnÃ©es"
      fail2ban: "sÃ©curitÃ©"

  tasks:
    - name: Parcourir les logiciels
      debug:
        msg: "{{ item.key }} est un {{ item.value }}"
      loop: "{{ logiciels | dict2items }}"
```

â–¶ï¸ `ansible-playbook -i hosts 08_loop_dict.yml`

---

### ğŸ›ï¸ 9. `loop_control`

ğŸ“„ `09_loop_control.yml`

```yaml
- name: Exemple avec loop_control
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Afficher les prÃ©noms avec contrÃ´le dâ€™index
      debug:
        msg: "Nom {{ ansible_loop.index }} : {{ item }}"
      loop:
        - Alice
        - Bob
        - ChloÃ©
      loop_control:
        label: "{{ item }}"
        index_var: mon_index
```

â–¶ï¸ `ansible-playbook -i hosts 09_loop_control.yml`

---

