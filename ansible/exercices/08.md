
---

## üß™ Objectif du TP Blocks

- Utiliser `block` pour regrouper plusieurs t√¢ches
- Simuler une erreur avec une commande √©chou√©e
- R√©cup√©rer l‚Äôerreur avec `rescue` pour effectuer une action corrective

---

## üìÅ Fichier d‚Äôinventaire `hosts`

Utiliser ce fichier `hosts` si vous ne l‚Äôavez pas d√©j√† :

```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

---

## üß© Fichier de playbook `block_with_rescue.yml`

```yaml
- name: TP - Utilisation des blocks avec rescue
  hosts: linux
  become: true
  gather_facts: false

  tasks:

    - name: Exemple d‚Äôutilisation de block/rescue
      block:

        - name: Cr√©er un fichier temporaire
          file:
            path: /tmp/exemple_block.txt
            state: touch

        - name: Simuler une erreur (commande √©chou√©e)
          command: /bin/false

        - name: Cette t√¢che ne sera pas ex√©cut√©e
          debug:
            msg: "Cette t√¢che ne s‚Äôex√©cute pas car la commande pr√©c√©dente a √©chou√©"

      rescue:

        - name: Afficher un message d‚Äôerreur
          debug:
            msg: "Une erreur a √©t√© d√©tect√©e, ex√©cution de la s√©quence de secours."

        - name: Supprimer le fichier temporaire
          file:
            path: /tmp/exemple_block.txt
            state: absent
```

---

## ‚ñ∂Ô∏è Commande de lancement

```bash
ansible-playbook -i hosts block_with_rescue.yml
```

---
