
---

## ğŸ§ª Objectif du TP Magic Variables

- Comprendre et exploiter les magic variables comme :
  - `inventory_hostname`
  - `ansible_host`
  - `group_names`
  - `hostvars`
  - `play_hosts`
  - `ansible_play_hosts_all`
  - `ansible_play_batch`
- Utiliser `when` avec ces variables
- Afficher les valeurs avec `debug`
- Utiliser ces variables dans une vraie tÃ¢che (`copy`, `template`, `file`â€¦)

---

## ğŸ“ Fichier dâ€™inventaire `hosts`

MÃªme fichier utilisÃ© prÃ©cÃ©demment :

```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

---

## ğŸ“„ Ã‰tape 1 â€” Explorer les magic variables

ğŸ“ `01_debug_magic.yml`

```yaml
- name: DÃ©couverte des magic variables
  hosts: linux
  gather_facts: true
  become: true

  tasks:
    - name: Afficher le nom dâ€™hÃ´te (inventory_hostname)
      debug:
        var: inventory_hostname

    - name: Afficher le nom rÃ©el (ansible_hostname)
      debug:
        var: ansible_hostname

    - name: Afficher les groupes dâ€™appartenance (group_names)
      debug:
        var: group_names

    - name: Afficher tous les hÃ´tes de la piÃ¨ce de jeu (ansible_play_hosts_all)
      debug:
        var: ansible_play_hosts_all
```

â–¶ï¸ `ansible-playbook -i hosts 01_debug_magic.yml`

---

## ğŸ“„ Ã‰tape 2 â€” Utiliser `hostvars` et `when` conditionnellement

ğŸ“ `02_hostvars_when.yml`

```yaml
- name: Utiliser hostvars et conditions
  hosts: linux
  gather_facts: true
  become: true

  tasks:
    - name: Afficher lâ€™adresse IP du host ubuntu1
      debug:
        msg: "Lâ€™IP de ubuntu1 est {{ hostvars['ubuntu1'].ansible_default_ipv4.address }}"
      when: "'ubuntu1' in groups['linux']"

    - name: Copier un fichier si on est centos1
      copy:
        content: "Bienvenue sur CentOS 1"
        dest: /tmp/centos1.txt
      when: inventory_hostname == 'centos1'
```

â–¶ï¸ `ansible-playbook -i hosts 02_hostvars_when.yml`

---

## ğŸ“„ Ã‰tape 3 â€” GÃ©nÃ©rer dynamiquement un fichier unique par hÃ´te

ğŸ“ `03_loop_inventory.yml`

```yaml
- name: Utiliser inventory_hostname pour crÃ©er des fichiers uniques
  hosts: linux
  gather_facts: false
  become: true

  tasks:
    - name: CrÃ©er un fichier nommÃ© selon lâ€™hÃ´te
      copy:
        content: "Ce fichier est destinÃ© Ã  {{ inventory_hostname }}"
        dest: "/tmp/{{ inventory_hostname }}.txt"
```

â–¶ï¸ `ansible-playbook -i hosts 03_loop_inventory.yml`

---

## ğŸ“„ Ã‰tape 4 â€” Utilisation avancÃ©e avec `ansible_play_batch`

ğŸ“ `04_batch.yml`

```yaml
- name: Utiliser ansible_play_batch pour voir les hÃ´tes en parallÃ¨le
  hosts: linux
  gather_facts: false
  become: true

  tasks:
    - name: Afficher les hÃ´tes du batch courant
      debug:
        msg: "Dans ce batch, nous avons : {{ ansible_play_batch }}"
```

â–¶ï¸ `ansible-playbook -i hosts 04_batch.yml`

---
