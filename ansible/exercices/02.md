
---

## üß™ TP ‚Äî Introduction aux Playbooks Ansible 

### üéØ Objectifs p√©dagogiques :
- Comprendre la structure d‚Äôun playbook
- Utiliser des variables, `gather_facts`, `become`, `when`
- Travailler avec les modules `debug`, `copy`, `file`
- Manipuler un handler

---

### üîß Pr√©requis
Fichier d'inventaire `hosts.txt` :
```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```

---

## √âtape 1 ‚Äî Structure de base et debug

1. Cr√©ez un fichier `playbook_intro.yml` :

```yaml
---
- name: Premier Playbook de Test
  hosts: linux
  become: true
  gather_facts: true

  tasks:
    - name: Afficher le nom de l'h√¥te
      debug:
        msg: "Je suis {{ inventory_hostname }}"
```

2. Ex√©cutez :
```bash
ansible-playbook -i hosts.txt playbook_intro.yml
```

‚úÖ Vous devez voir chaque machine imprimer son propre nom.

---

## √âtape 2 ‚Äî Ajouter une variable personnalis√©e

1. Ajoutez un bloc `vars` et une nouvelle t√¢che :

```yaml
  vars:
    mon_message: "Bienvenue sur {{ inventory_hostname }}"

  tasks:
    - name: √âcrire un message dans un fichier
      copy:
        dest: /tmp/bonjour.txt
        content: "{{ mon_message }}"
```

2. Ex√©cutez :
```bash
ansible-playbook -i hosts.txt playbook_intro.yml
```

‚úÖ V√©rifiez sur les h√¥tes : `/tmp/bonjour.txt` doit contenir un message personnalis√©.

---

## √âtape 3 ‚Äî Cr√©er un fichier conditionnel (module `file` + `when`)

1. Ajoutez ceci √† la fin de `tasks` :

```yaml
    - name: Cr√©er un fichier sp√©cifique pour Ubuntu
      file:
        path: /tmp/ubuntu_only.txt
        state: touch
      when: ansible_distribution == "Ubuntu"
```

2. Ex√©cutez :
```bash
ansible-playbook -i hosts.txt playbook_intro.yml
```

‚úÖ Seuls les h√¥tes Ubuntu auront `/tmp/ubuntu_only.txt`.

---

## √âtape 4 ‚Äî Ajouter un handler

1. Ajoutez cette t√¢che :

```yaml
    - name: Copier un fichier de configuration fictif
      copy:
        dest: /tmp/fichier_config.txt
        content: "param=value"
      notify: Red√©marrer un service fictif
```

2. En bas du playbook, ajoutez :

```yaml
  handlers:
    - name: Red√©marrer un service fictif
      debug:
        msg: "Handler ex√©cut√© : service fictif red√©marr√©"
```

3. Ex√©cutez :
```bash
ansible-playbook -i hosts.txt playbook_intro.yml
```

‚úÖ Lors du premier lancement, le handler doit se d√©clencher. Si vous relancez imm√©diatement, le handler ne s'ex√©cutera pas (car le fichier n'a pas chang√©).

---
