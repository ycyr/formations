Parfaitâ€¯! Voici un **TP3** focalisÃ© sur les **variables dans les playbooks Ansible**, avec des exercices pratiques couvrant toutes les thÃ©matiques que tu veux intÃ©grer :

---

## ğŸ§ª TP3 â€” Utilisation des Variables dans les Playbooks Ansible

### ğŸ¯ Objectifs pÃ©dagogiques :
- DÃ©clarer et utiliser des variables dans un playbook
- CrÃ©er et utiliser des fichiers de variables externes
- Comprendre `host_vars`, `group_vars` et `hostvars`
- Utiliser `vars_prompt`
- DÃ©finir une valeur par dÃ©faut avec le filtre Jinja2 `default`
- Surcharger une variable depuis la ligne de commande avec `-e`

---

### ğŸ“ PrÃ©paration

Fichier d'inventaire `hosts.txt` :
```ini
[control]
ubuntu-c ansible_connection=local

[centos]
centos1 ansible_port=2222
centos[2:3]

[centos:vars]
ansible_user=root

[ubuntu]
ubuntu[1:3]

[ubuntu:vars]
ansible_become=true
ansible_become_pass=password

[linux:children]
centos
ubuntu
```


---

### ğŸ§© Ã‰tape 1 â€” Variables internes dans le playbook

`playbook_var.yml`
```yaml
- name: TP3 - Variables dans les Playbooks
  hosts: linux
  become: true
  gather_facts: false

  vars:
    message_local: "Message dÃ©fini dans le playbook"

  tasks:
    - name: Affichage de la variable interne
      debug:
        msg: "{{ message_local }}"
```

âœ… **Lancez** :
```bash
ansible-playbook -i hosts.txt playbook_var.yml
```

---

### ğŸ§© Ã‰tape 2 â€” Fichier de variables externes

1. CrÃ©ez `vars_fichier.yml` :

```yaml
message_externe: "Message depuis un fichier externe"
```

2. Modifiez le playbook :

```yaml
  vars_files:
    - vars_fichier.yml

  tasks:
    - name: Affichage de la variable externe
      debug:
        msg: "{{ message_externe }}"
```

âœ… Relancez le playbook.

---

### ğŸ§© Ã‰tape 3 â€” `group_vars` et `host_vars`

1. CrÃ©ez `group_vars/linux.yml` :
```yaml
message_group: "Message pour le groupe Linux"
```

2. CrÃ©ez `host_vars/centos1.yml` :
```yaml
message_host: "Message spÃ©cifique Ã  centos1"
```

3. Ajoutez ces tÃ¢ches :

```yaml
    - name: Message par groupe
      debug:
        msg: "{{ message_group }}"

    - name: Message spÃ©cifique Ã  centos1
      debug:
        msg: "{{ message_host | default('Non dÃ©fini pour cet hÃ´te') }}"
```

âœ… Relancez le playbook.

---

### ğŸ§© Ã‰tape 4 â€” Utiliser `hostvars`

Ajoutez cette tÃ¢che :

```yaml
    - name: Lire une variable d'un autre hÃ´te
      debug:
        msg: "Variable de centos1 : {{ hostvars['centos1'].message_host | default('inconnue') }}"
```

---

### ğŸ§© Ã‰tape 5 â€” `vars_prompt`

Ajoutez au dÃ©but du playbook :
```yaml
  vars_prompt:
    - name: message_secret
      prompt: "Entrez un message secret"
      private: no
```

Et cette tÃ¢che :
```yaml
    - name: Affichage du message secret
      debug:
        msg: "{{ message_secret }}"
```

---

### ğŸ§© Ã‰tape 6 â€” `default` dans une variable

Ajoutez :
```yaml
    - name: Utilisation de la variable avec default
      debug:
        msg: "{{ var_inexistante | default('valeur par dÃ©faut utilisÃ©e') }}"
```

---

### ğŸ§© Ã‰tape 7 â€” Ligne de commande `-e`

Testez :
```bash
ansible-playbook -i hosts.txt playbook_var.yml -e "message_local='Sur-Ã©crit par -e'"
```

âœ… Observez que `message_local` a Ã©tÃ© remplacÃ©.

---
